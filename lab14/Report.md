# Отчет по лабораторной работе №14 по Мат Моделированию

## 1-2. Содержательная постановка задачи
14.1 Суть поставленной задачи:
* Придумать матрицу взаимодолгов 15 предприятий.
* Провести взаимозачет для смоделированной ситуации.

14.2Суть поставленной задачи:
* Придумать матрицу взаимодолгов 20 предприятий.
* Провести взаимозачет для смоделированной ситуации.

## 3. Концептуальная постанока задачи
При разработке данной модели принимаются следующие предположения:

* Проблема неплатежей вызвана исключительно недостатками расчетных процедур, без учета макроэкономических факторов.
* Все задолженности между предприятиями полностью известны и признаются всеми сторонами.
* При осуществлении взаимозачета балансовые значения обязательств и долгов предприятий остаются без изменений.
* Часть долговых обязательств может быть аннулирована, в то время как оставшиеся могут быть перераспределены, то есть у предприятий могут возникнуть новые контрагенты по долговым обязательствам, а часть предыдущих кредиторов и должников исчезнет.
## 4. Математическая постановка задачи
```math
\text{Совокупность долгов описывается кососимметричной матрицей размера } N \times N \text{ с нулевой диагональю.} \\
\text{Сумма всех взаимных долгов вычисляется через индивидуальные долги как } X = \sum_{n=1}^N \sum_{m=1}^N |x_{nm}|. \\
\text{X служит одной из количественных характеристик финансового положения системы. Если она сопоставима с суммой всех свободных средств предприятий } X_0, \text{ т.е. } X \geq X_0 = \sum_{n=1}^N x_n, \\
\text{то описываемая этим неравенством ситуация и означает кризис неплатежей (здесь } x_{nm} \geq 0 \text{ – индивидуальные свободные средства предприятий).} \\

\text{Баланс кредитов и долгов (сальдо) каждого предприятия рассчитывается как } S_n = \sum_{m=1}^N x_{nm}. \\
\text{Причем, как из этого выражения, очевидно, возможны варианты } S_n > 0, S_n < 0, S_n = 0. \\
\text{При } S_n \text{ предприятие является в некотором смысле кредитором предприятий-должников, т.е. тех, у кого } S_n < 0. \\
\text{При } S_n = 0 \text{ предприятие в отношении долгов "нейтрально". При } |S_n| = 0 \text{ индивидуальное финансовое состояние предприятия нормальное,}\\ 
\text{поскольку его реальные суммарные долги меньше его свободных средств.} \\

\text{Суммарное абсолютное сальдо системы рассчитывается как } S = \sum_{n=1}^N |S_n|. \\
\text{Если } S < X_0, \text{ то свободных средств в системе больше, чем долгов, и она может успешно функционировать дальше.} \\

\text{Между величинами } X \text{ и } S \text{ всегда существует определенное соотношение. Для любой произвольной матрицы долгов выполняется неравенство } X \geq S, \\
\text{т.е. суммарный долг не может быть меньше суммарного сальдо.} \\

\text{Задача погашения взаимных долгов состоит в том, чтобы, зная матрицу } x_{nm}, \text{ найти матрицу } x'_{nm} \text{ "новых" долгов, для которой выполнялось бы } X' < X \text{ (идеально } X' = S). \\

\text{Суть макропроцедуры взаимозачёта состоит в том, что вместо величин } x_{nm} \text{ рассматриваются } S_n. \\
\text{Предприятия с } S_n < 0 \text{ считаются должниками, а предприятия с } S_n > 0 \text{ - кредиторами. Затем долги предприятий-должников каким-то образом распределяются между кредиторами, т.е. находит новая система долгов } x'{nm}. \\
\text{При этом выполняется } \sum{n=1}^N |S_n| = 0 \text{ и достигается равенство } X' = S. \\
\text{Такое решение задачи является оптимальным.} \\

\text{Одно из оптимальных решений задаётся формулой, по которой новые долги вычисляются через старые: } x'_{nm} = \frac{S_n |S_m| - S_m |S_n|}{S}. \\
\text{Согласно этому алгоритму, долг любого предприятия расписывается по предприятиям-кредиторам в долях, пропорциональных величинам их сальдо.} \\
\text{Предприятиям с большим положительным сальдо причитается от каждого из должников большая часть его долгов.} \\
\text{Для предприятий с нулевым сальдо взаимозачёт сводится к погашению всех их долгов и всех долгов им.}
```
## 5. Реализация
14.1:
```python
import numpy as np

N = 15 
X_nm = np.zeros((N, N))


for i in range(N):
    for j in range(N):
        if i != j:
            X_nm[i, j] = 100 - round(100 * np.random.rand()) - 50
            X_nm[j, i] = X_nm[i, j] 

with open('results.txt', 'w') as f:
    
    total_debt = np.sum(np.abs(X_nm))  
    f.write(f"Сумма всех взаимных долгов: {total_debt:.0f}\n\n")
    f.write("Кососиметрическая матрица:\n")
    for i in range(N):
        f.write(f"Предприятие {i + 1}: {np.array_str(X_nm[i, :i + 1].astype(int), max_line_width=np.inf)}\n")

    
    Sn = np.sum(X_nm, axis=1) 
    S = np.sum(np.abs(Sn))

    
    for i in range(N):
        for j in range(N):
            if S != 0: 
                X_nm[i, j] = (Sn[i] * np.abs(Sn[j]) - Sn[j] * np.abs(Sn[i])) / S
            else:
                X_nm[i, j] = 0 

    total_debt_after_settlement = np.sum(np.abs(X_nm))
    f.write(f"\nСумма всех взаимных долгов после взаимозачета: {total_debt_after_settlement:.5f}\n")
    f.write("Кососиметрическая матрица после взаимозачета:\n")
    for i in range(N):
        f.write(f"Предприятие {i + 1}: {np.array_str(np.round(X_nm[i, :i + 1], 2), max_line_width=np.inf)}\n")

print("Результаты записаны в файл 'results.txt'")
```

14.2:
```python
import numpy as np

N = 20
X_nm = np.zeros((N, N))


for i in range(N):
    for j in range(N):
        if i != j:
            X_nm[i, j] = 100 - round(100 * np.random.rand()) - 50
            X_nm[j, i] = X_nm[i, j] 

with open('results.txt', 'w') as f:
    
    total_debt = np.sum(np.abs(X_nm))  
    f.write(f"Сумма всех взаимных долгов: {total_debt:.0f}\n\n")
    f.write("Кососиметрическая матрица:\n")
    for i in range(N):
        f.write(f"Предприятие {i + 1}: {np.array_str(X_nm[i, :i + 1].astype(int), max_line_width=np.inf)}\n")

    
    Sn = np.sum(X_nm, axis=1) 
    S = np.sum(np.abs(Sn))

    
    for i in range(N):
        for j in range(N):
            if S != 0: 
                X_nm[i, j] = (Sn[i] * np.abs(Sn[j]) - Sn[j] * np.abs(Sn[i])) / S
            else:
                X_nm[i, j] = 0 

    total_debt_after_settlement = np.sum(np.abs(X_nm))
    f.write(f"\nСумма всех взаимных долгов после взаимозачета: {total_debt_after_settlement:.5f}\n")
    f.write("Кососиметрическая матрица после взаимозачета:\n")
    for i in range(N):
        f.write(f"Предприятие {i + 1}: {np.array_str(np.round(X_nm[i, :i + 1], 2), max_line_width=np.inf)}\n")

print("Результаты записаны в файл 'results2.txt'")
```
## 7. Численное иследование модели
14.1:

Сумма всех взаимных долгов: 4596

Кососиметрическая матрица:
Предприятие 1: [0]

Предприятие 2: [34  0]

Предприятие 3: [-14  34   0]

Предприятие 4: [43  3 29  0]

Предприятие 5: [-2 17 14 22  0]

Предприятие 6: [ -8  10  34   8 -16   0]

Предприятие 7: [ 44 -11  -1 -38   4 -10   0]

Предприятие 8: [29 19  5 27 -2 28 -3  0]

Предприятие 9: [-35 -34 -20   0 -15  -2 -31  33   0]

Предприятие 10: [-27 -15  41  24  25  16  30 -10  -1   0]

Предприятие 11: [ 19  37 -50 -26  38 -28 -18 -44  10 -17   0]

Предприятие 12: [ -5 -16 -22  41  32 -49  45  47  37  31 -41   0]

Предприятие 13: [ 32   5  -1  -8  33 -27  -6  22  32  -1 -43  -2   0]

Предприятие 14: [ -6  -6 -45   9   1  26  42  -3  10 -48 -22  12 -41   0]

Предприятие 15: [ 30  24 -38 -24 -26   2   8  10 -12  25   0 -10  42  43   0]


Сумма всех взаимных долгов после взаимозачета: 894.74404

Кососиметрическая матрица после взаимозачета:

Предприятие 1: [0.]

Предприятие 2: [0. 0.]

Предприятие 3: [-7.24 -5.46  0.  ]

Предприятие 4: [0.   0.   5.95 0.  ]

Предприятие 5: [0.   0.   6.76 0.   0.  ]

Предприятие 6: [-3.41 -2.57  0.   -2.8  -3.18  0.  ]

Предприятие 7: [0.   0.   2.97 0.   0.   1.4  0.  ]

Предприятие 8: [0.   0.   8.54 0.   0.   4.02 0.   0.  ]

Предприятие 9: [-5.97 -4.5   0.   -4.9  -5.56  0.   -2.45 -7.03  0.  ]

Предприятие 10: [0.   0.   3.95 0.   0.   1.86 0.   0.   3.25 0.  ]

Предприятие 11: [-39.41 -29.71   0.   -32.35 -36.76   0.   -16.18 -46.47   0.   -21.47   0.  ]

Предприятие 12: [ 0.    0.    5.41  0.    0.    2.54  0.    0.    4.45  0.   29.41  0.  ]

Предприятие 13: [ 0.    0.    2.    0.    0.    0.94  0.    0.    1.65  0.   10.88  0.    0.  ]

Предприятие 14: [-5.97 -4.5   0.   -4.9  -5.56  0.   -2.45 -7.03  0.   -3.25  0.   -4.45 -1.65  0.  ]

Предприятие 15: [ 0.    0.    4.    0.    0.    1.88  0.    0.    3.29  0.   21.76  0.    0.    3.29  0.  ]

14.2:

Сумма всех взаимных долгов: 9116

Кососиметрическая матрица:

Предприятие 1: [0]

Предприятие 2: [18  0]

Предприятие 3: [-16 -17   0]

Предприятие 4: [ 34 -12  18   0]

Предприятие 5: [ 2  1 13 -9  0]

Предприятие 6: [ 21 -18 -24 -20 -34   0]

Предприятие 7: [ 20   2 -44  10  42  23   0]

Предприятие 8: [ 28   6 -14  -8   2 -23  26   0]

Предприятие 9: [-48 -26  46  23  48  -2  17  45   0]


Предприятие 10: [ 36  20  46  37 -35 -28 -39 -36 -31   0]

Предприятие 11: [ 21  42  50  17  27  11  36   4  33 -12   0]

Предприятие 12: [ 21  12 -13 -19  -7 -42  25 -23 -45  28  -9   0]

Предприятие 13: [ 25  35  24 -31 -17 -26  49  -9  -9 -38 -17 -24   0]

Предприятие 14: [ 49 -22 -27 -11  45 -19 -11  42 -11  25 -23 -19 -22   0]

Предприятие 15: [-33  13 -12 -40  13   4  50  26  -2 -40  39  47  40  -4   0]

Предприятие 16: [-46   9 -25 -12  13  36   3  40  43  17  21 -19  14   1  42   0]

Предприятие 17: [-36 -35   3   4 -12 -49  22 -13 -19 -15 -40 -12 -26  15 -35  18   0]

Предприятие 18: [ -2 -25   6  29  22 -38 -18 -43  39 -20  -2 -50  17 -49  -6 -13 -20   0]

Предприятие 19: [ -5  25 -21  20  -7 -40  21  -1  26 -37  27  -6 -25 -49  25  37 -22 -17   0]

Предприятие 20: [ 13 -32 -30  46 -33 -27   0  37  18  12  10  28  21  35 -46  44  -3  29  31   0]

Сумма всех взаимных долгов после взаимозачета: 2472.20558

Кососиметрическая матрица после взаимозачета:

Предприятие 1: [0.]

Предприятие 2: [-0.33  0.  ]

Предприятие 3: [-3.01  0.    0.  ]

Предприятие 4: [0.   0.24 2.24 0.  ]

Предприятие 5: [0.   0.24 2.18 0.   0.  ]

Предприятие 6: [-23.98   0.     0.   -17.86 -17.39   0.  ]

Предприятие 7: [ 0.    0.75  6.9   0.    0.   55.    0.  ]

Предприятие 8: [ 0.    0.27  2.54  0.    0.   20.22  0.    0.  ]

Предприятие 9: [ 0.    0.46  4.27  0.    0.   34.08  0.    0.    0.  ]

Предприятие 10: [ -8.94   0.     0.    -6.66  -6.49   0.   -20.51  -7.54 -12.71   0.  ]

Предприятие 11: [ 0.    0.75  6.93  0.    0.   55.24  0.    0.    0.   20.6   0.  ]

Предприятие 12: [-10.32   0.     0.    -7.69  -7.49   0.   -23.68  -8.7  -14.67   0.   -23.78   0.  ]

Предприятие 13: [-1.54  0.    0.   -1.15 -1.12  0.   -3.54 -1.3  -2.2   0.   -3.56  0.    0.  ]

Предприятие 14: [ -4.47   0.     0.    -3.33  -3.24   0.   -10.25  -3.77  -6.35   0.   -10.3    0.     0.     0.  ]

Предприятие 15: [ 0.    0.26  2.39  0.    0.   19.04  0.    0.    0.    7.1   0.    8.2   1.23  3.55  0.  ]

Предприятие 16: [ 0.    0.71  6.57  0.    0.   52.42  0.    0.    0.   19.55  0.   22.57  3.38  9.77  0.    0.  ]

Предприятие 17: [-22.35   0.     0.   -16.65 -16.22   0.   -51.27 -18.84 -31.77   0.   -51.49   0.     0.     0.   -17.75 -48.86   0.  ]

Предприятие 18: [-13.09   0.     0.    -9.75  -9.49   0.   -30.02 -11.03 -18.6    0.   -30.15   0.     0.     0.   -10.39 -28.61   0.     0.  ]

Предприятие 19: [-1.46  0.    0.   -1.09 -1.06  0.   -3.36 -1.23 -2.08  0.   -3.37  0.    0.    0.   -1.16 -3.2   0.    0.    0.  ]

Предприятие 20: [ 0.    0.49  4.51  0.    0.   35.96  0.    0.    0.   13.41  0.   15.48  2.32  6.71  0.    0.   33.53 19.63  2.19  0.  ]
